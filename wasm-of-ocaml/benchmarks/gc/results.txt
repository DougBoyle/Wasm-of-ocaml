Demonstrating difference between unoptimised and improved version:
-
Allocate 8040 cells of various sizes, including 402 large cells.
Corresponds to 3 pages in old version, 4 pages in new version (due to trailers)
Free those 402 cells as well as 4020 of the small cells.
-
Repeatedly allocate and release those 402 large cells, penalty for old version
as it must scan over 10 small cells for each large cell it allocates, whereas
new version uses bins
-
In both cases, data collected with all tracing information disabled to maximise performance
-
Old Version: (number is how many times those 402 cells re-allocated)
Iters   Mean    Standard Deviation (both in ms)
10      2.829   0.024
15      3.659   0.063
20      4.477   0.043
25      5.127   0.074
30      6.034   0.075
35      6.726   0.111
40      8.216   0.253
45      8.359   0.122
50      9.066   0.111
55      9.923   0.137
60      10.606  0.156
65      11.332  0.109
70      12.042  0.146
75      12.706  0.128
80      13.579  0.164
85      14.317  0.161
90      15.192  0.212
95      15.874  0.250
100     16.704  0.287
105     17.604  0.292
110     18.244  0.260
115     19.088  0.238
120     20.174  0.363
125     20.838  0.306
130     21.358  0.234
135     22.229  0.331
140     23.043  0.252
145     23.836  0.300
150     24.656  0.312
155     25.479  0.378
160     26.078  0.286
165     26.919  0.374
170     27.595  0.296
175     28.146  0.288
180     29.325  0.355
185     29.827  0.236
190     30.348  0.241
195     31.170  0.453
200     32.078  0.317
205     33.005  0.392
210     33.806  0.370
215     34.356  0.284
220     35.805  0.382
225     36.304  0.390
230     36.999  0.427
235     37.659  0.357
240     38.714  0.449
245     39.118  0.392
250     40.037  0.388
255     40.876  0.603
260     41.741  0.479
265     42.736  0.608
270     43.237  0.421
275     46.155  1.182
280     45.416  0.494
285     45.339  0.420
290     46.393  0.498
295     46.768  0.436
300     48.138  0.604

New Without Threshold:
10      2.569   0.100
15      3.145   0.117
20      3.781   0.182
25      4.073   0.137
30      4.660   0.128
35      5.074   0.145
40      5.499   0.151
45      6.075   0.150
50      6.550   0.147
55      7.066   0.192
60      7.474   0.135
65      7.967   0.124
70      8.450   0.146
75      8.883   0.174
80      9.456   0.224
85      9.819   0.180
90      10.482  0.202
95      10.744  0.214
100     11.240  0.161
105     11.728  0.226
110     12.014  0.187
115     12.638  0.204
120     13.213  0.172
125     13.512  0.240
130     14.016  0.145
135     14.411  0.185
140     14.927  0.154
145     15.377  0.189
150     15.947  0.229
155     16.735  0.274
160     16.803  0.184
165     17.130  0.112
170     17.854  0.199
175     18.277  0.216
180     18.631  0.168
185     19.205  0.237
190     19.933  0.304
195     20.292  0.219
200     20.690  0.196
205     21.368  0.356
210     21.760  0.428
215     22.375  0.350
220     22.656  0.216
225     23.328  0.230
230     23.488  0.309
235     24.128  0.279
240     26.069  0.792
245     25.306  0.329
250     25.431  0.216
255     26.344  0.332
260     26.851  0.264
265     27.156  0.245
270     28.864  0.307
275     27.768  0.255
280     28.220  0.213
285     29.193  0.328
290     29.842  0.461
295     30.900  0.598
300     33.533  0.857

New Version:
10      2.644   0.109
15      3.284   0.146
20      3.838   0.189
25      4.225   0.158
30      4.738   0.138
35      5.176   0.126
40      5.690   0.166
45      6.182   0.148
50      6.738   0.144
55      7.204   0.137
60      7.713   0.139
65      8.237   0.180
70      8.628   0.173
75      8.960   0.175
80      9.700   0.173
85      9.989   0.223
90      10.653  0.155
95      11.198  0.237
100     11.411  0.145
105     12.277  0.195
110     12.474  0.156
115     13.042  0.189
120     13.541  0.271
125     13.877  0.151
130     14.460  0.220
135     14.984  0.148
140     15.383  0.150
145     16.055  0.257
150     16.334  0.220
155     16.927  0.183
160     17.270  0.152
165     17.845  0.170
170     18.376  0.155
175     19.083  0.282
180     19.546  0.228
185     19.991  0.183
190     20.106  0.327
195     20.775  0.176
200     21.464  0.256
205     21.850  0.239
210     22.669  0.293
215     22.937  0.234
220     23.490  0.338
225     23.878  0.339
230     25.442  0.716
235     25.092  0.309
240     26.165  0.681
245     26.157  0.316
250     26.456  0.266
255     27.098  0.293
260     27.601  0.423
265     28.104  0.327
270     28.587  0.413
275     28.271  0.390
280     29.354  0.299
285     31.122  0.326
290     31.534  0.237
295     32.125  0.440
300     32.717  0.399
