module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=9)}([function(e,t){e.exports=require("fs")},function(e,t,r){e.exports=function(){function e(t,r,n,i,o,s,a){var u,c,f="",l=0,h=i.slice(0);if(h.push([r,n])&&i.length>0&&(i.forEach((function(e,t){t>0&&(f+=(e[1]?" ":"│")+"  "),c||e[0]!==r||(c=!0)})),f+=function(e,t){var r=t?"└":"├";return r+=e?"─ ":"──┐"}(t,n)+t,o&&("object"!=typeof r||r instanceof Date)&&(f+=": "+r),c&&(f+=" (circular ref.)"),a(f)),!c&&"object"==typeof r){var d=function(e,t){var r=[];for(var n in e)e.hasOwnProperty(n)&&(t&&"function"==typeof e[n]||r.push(n));return r}(r,s);d.forEach((function(t){u=++l===d.length,e(t,r[t],u,h,o,s,a)}))}}var t={asLines:function(t,r,n,i){e(".",t,!1,[],r,"function"!=typeof n&&n,i||n)},asTree:function(t,r,n){var i="";return e(".",t,!1,[],r,n,(function(e){i+=e+"\n"})),i}};return t}()},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("tty")},function(e,t){e.exports=require("path")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function i(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function o(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function s(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;e=r.call(e);var n,i=[];try{for(;(void 0===t||0<t--)&&!(n=e.next()).done;)i.push(n.value)}catch(e){var o={error:e}}finally{try{n&&!n.done&&(r=e.return)&&r.call(e)}finally{if(o)throw o.error}}return i}function a(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e}var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:{},c="undefined"!=typeof BigInt?BigInt:u.BigInt||Number,f=DataView;f.prototype.setBigUint64||(f.prototype.setBigUint64=function(e,t,r){if(t<Math.pow(2,32))var n=0;else{n=t.toString(2),t="";for(var i=0;i<64-n.length;i++)t+="0";t+=n,n=parseInt(t.substring(0,32),2),t=parseInt(t.substring(32),2)}this.setUint32(e+(r?0:4),t,r),this.setUint32(e+(r?4:0),n,r)},f.prototype.getBigUint64=function(e,t){var r=this.getUint32(e+(t?0:4),t);e=this.getUint32(e+(t?4:0),t),r=r.toString(2),e=e.toString(2),t="";for(var n=0;n<32-r.length;n++)t+="0";return c("0b"+e+(t+r))});var l,h=f,d=Buffer,m=r(2),p=r(0),y=r(3).isatty,g=r(4),_=(l=process.hrtime,function(e){return 1e9*(e=l(e))[0]+e[1]});process.hrtime&&process.hrtime.bigint&&(_=process.hrtime.bigint);var v,b,w={hrtime:_,exit:function(e){process.exit(e)},kill:function(e){process.kill(process.pid,e)},randomFillSync:m.randomFillSync,isTTY:y,fs:p,path:g},S=c(1),E=c(2),R=c(4),O=c(8),M=c(16),U=c(32),k=c(64),A=c(128),I=c(256),x=c(512),N=c(1024),T=c(2048),L=c(4096),B=c(8192),C=c(16384),D=c(32768),P=c(65536),G=c(131072),j=c(262144),F=c(524288),$=c(1048576),H=c(2097152),W=c(4194304),z=c(8388608),Y=c(16777216),Q=c(33554432),K=c(67108864),V=c(134217728),q=c(268435456),X=S|E|R|O|M|U|k|A|I|x|N|T|L|B|C|D|P|G|j|F|$|H|z|W|Y|K|Q|V|q,Z=X,J=X,ee=X,te=X,re=S|E|R|O|M|U|k|A|I|H|W|z|V,ne=c(0),ie=O|M|A|x|N|T|L|B|C|D|P|G|j|F|$|H|z|Y|K|Q|V,oe=ie|re,se=E|O|k|H|V|q,ae=X,ue=E|O|k|H|V,ce=c(0),fe={E2BIG:1,EACCES:2,EADDRINUSE:3,EADDRNOTAVAIL:4,EAFNOSUPPORT:5,EALREADY:7,EAGAIN:6,EBADF:8,EBADMSG:9,EBUSY:10,ECANCELED:11,ECHILD:12,ECONNABORTED:13,ECONNREFUSED:14,ECONNRESET:15,EDEADLOCK:16,EDESTADDRREQ:17,EDOM:18,EDQUOT:19,EEXIST:20,EFAULT:21,EFBIG:22,EHOSTDOWN:23,EHOSTUNREACH:23,EIDRM:24,EILSEQ:25,EINPROGRESS:26,EINTR:27,EINVAL:28,EIO:29,EISCONN:30,EISDIR:31,ELOOP:32,EMFILE:33,EMLINK:34,EMSGSIZE:35,EMULTIHOP:36,ENAMETOOLONG:37,ENETDOWN:38,ENETRESET:39,ENETUNREACH:40,ENFILE:41,ENOBUFS:42,ENODEV:43,ENOENT:44,ENOEXEC:45,ENOLCK:46,ENOLINK:47,ENOMEM:48,ENOMSG:49,ENOPROTOOPT:50,ENOSPC:51,ENOSYS:52,ENOTCONN:53,ENOTDIR:54,ENOTEMPTY:55,ENOTRECOVERABLE:56,ENOTSOCK:57,ENOTTY:59,ENXIO:60,EOVERFLOW:61,EOWNERDEAD:62,EPERM:63,EPIPE:64,EPROTO:65,EPROTONOSUPPORT:66,EPROTOTYPE:67,ERANGE:68,EROFS:69,ESPIPE:70,ESRCH:71,ESTALE:72,ETIMEDOUT:73,ETXTBSY:74,EXDEV:75},le=((v={})[6]="SIGHUP",v[8]="SIGINT",v[11]="SIGQUIT",v[7]="SIGILL",v[15]="SIGTRAP",v[0]="SIGABRT",v[2]="SIGBUS",v[5]="SIGFPE",v[9]="SIGKILL",v[20]="SIGUSR1",v[12]="SIGSEGV",v[21]="SIGUSR2",v[10]="SIGPIPE",v[1]="SIGALRM",v[14]="SIGTERM",v[3]="SIGCHLD",v[4]="SIGCONT",v[13]="SIGSTOP",v[16]="SIGTSTP",v[17]="SIGTTIN",v[18]="SIGTTOU",v[19]="SIGURG",v[23]="SIGXCPU",v[24]="SIGXFSZ",v[22]="SIGVTALRM",v);b=w;var he=S|E|M|A|H|V,de=S|k|M|A|H|V,me=de,pe=function(e){var t=Math.trunc(e);return e=c(Math.round(1e6*(e-t))),c(t)*c(1e6)+e},ye=function(e){return"number"==typeof e&&(e=Math.trunc(e)),e=c(e),Number(e/c(1e6))},ge=function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{return e.apply(void 0,a(t))}catch(e){if(e&&e.code&&"string"==typeof e.code)return fe[e.code]||28;if(e instanceof be)return e.errno;throw e}}},_e=function(e,t){var r=e.FD_MAP.get(t);if(!r)throw new be(8);if(void 0===r.filetype){var n=e.bindings.fs.fstatSync(r.real);t=(e=ve(e,t,n)).rightsBase,n=e.rightsInheriting,r.filetype=e.filetype,r.rights||(r.rights={base:t,inheriting:n})}return r},ve=function(e,t,r){switch(!0){case r.isBlockDevice():return{filetype:1,rightsBase:Z,rightsInheriting:J};case r.isCharacterDevice():return r=2,void 0!==t&&e.bindings.isTTY(t)?{filetype:r,rightsBase:ue,rightsInheriting:ce}:{filetype:r,rightsBase:ee,rightsInheriting:te};case r.isDirectory():return{filetype:3,rightsBase:ie,rightsInheriting:oe};case r.isFIFO():return{filetype:6,rightsBase:se,rightsInheriting:ae};case r.isFile():return{filetype:4,rightsBase:re,rightsInheriting:ne};case r.isSocket():return{filetype:6,rightsBase:se,rightsInheriting:ae};case r.isSymbolicLink():return{filetype:7,rightsBase:c(0),rightsInheriting:c(0)};default:return{filetype:0,rightsBase:c(0),rightsInheriting:c(0)}}},be=function(e){function t(r){var n=e.call(this)||this;return n.errno=r,Object.setPrototypeOf(n,t.prototype),n}return i(t,e),t}(Error),we=function(e){function t(r){var n=e.call(this,"WASI Exit error: "+r)||this;return n.code=r,Object.setPrototypeOf(n,t.prototype),n}return i(t,e),t}(Error),Se=function(e){function t(r){var n=e.call(this,"WASI Kill signal: "+r)||this;return n.signal=r,Object.setPrototypeOf(n,t.prototype),n}return i(t,e),t}(Error),Ee=function(){function e(e){var t,r=this,n={};e&&e.preopens?n=e.preopens:e&&e.preopenDirectories&&(n=e.preopenDirectories);var i={};e&&e.env&&(i=e.env);var u=[];e&&e.args&&(u=e.args);var f=b;e&&e.bindings&&(f=e.bindings),this.view=this.memory=void 0,this.bindings=f,this.FD_MAP=new Map([[0,{real:0,filetype:2,rights:{base:he,inheriting:c(0)},path:void 0}],[1,{real:1,filetype:2,rights:{base:de,inheriting:c(0)},path:void 0}],[2,{real:2,filetype:2,rights:{base:me,inheriting:c(0)},path:void 0}]]);var l=this.bindings.fs,h=this.bindings.path;try{for(var m=o(Object.entries(n)),p=m.next();!p.done;p=m.next()){var y=s(p.value,2),g=y[0],_=y[1],v=l.openSync(_,l.constants.O_RDONLY),w=a(this.FD_MAP.keys()).reverse()[0]+1;this.FD_MAP.set(w,{real:v,filetype:3,rights:{base:ie,inheriting:oe},fakePath:g,path:_})}}catch(e){var V={error:e}}finally{try{p&&!p.done&&(t=m.return)&&t.call(m)}finally{if(V)throw V.error}}var q=function(e,t){return r.refreshMemory(),Array.from({length:t},(function(t,n){return n=e+8*n,t=r.view.getUint32(n,!0),n=r.view.getUint32(n+4,!0),new Uint8Array(r.memory.buffer,t,n)}))},X=function(e,t){if(e=_e(r,e),t!==c(0)&&(e.rights.base&t)===c(0))throw new be(63);return e},Z=f.hrtime(),J=function(e){switch(e){case 1:return f.hrtime();case 0:return pe(Date.now());case 2:case 3:return f.hrtime()-Z;default:return null}};this.wasiImport={args_get:function(e,t){r.refreshMemory();var n=e,i=t;return u.forEach((function(e){r.view.setUint32(n,i,!0),n+=4,i+=d.from(r.memory.buffer).write(e+"\0",i)})),0},args_sizes_get:function(e,t){return r.refreshMemory(),r.view.setUint32(e,u.length,!0),e=u.reduce((function(e,t){return e+d.byteLength(t)+1}),0),r.view.setUint32(t,e,!0),0},environ_get:function(e,t){r.refreshMemory();var n=e,o=t;return Object.entries(i).forEach((function(e){var t=s(e,2);e=t[0],t=t[1],r.view.setUint32(n,o,!0),n+=4,o+=d.from(r.memory.buffer).write(e+"="+t+"\0",o)})),0},environ_sizes_get:function(e,t){r.refreshMemory();var n=Object.entries(i).map((function(e){return(e=s(e,2))[0]+"="+e[1]+"\0"})),o=n.reduce((function(e,t){return e+d.byteLength(t)}),0);return r.view.setUint32(e,n.length,!0),r.view.setUint32(t,o,!0),0},clock_res_get:function(e,t){switch(e){case 1:case 2:case 3:var n=c(1);break;case 0:n=c(1e3)}return r.view.setBigUint64(t,n),0},clock_time_get:function(e,t,n){return r.refreshMemory(),null===(e=J(e))?28:(r.view.setBigUint64(n,c(e),!0),0)},fd_advise:ge((function(e,t,r,n){return X(e,A),52})),fd_allocate:ge((function(e,t,r){return X(e,I),52})),fd_close:ge((function(e){var t=X(e,c(0));return l.closeSync(t.real),r.FD_MAP.delete(e),0})),fd_datasync:ge((function(e){return e=X(e,S),l.fdatasyncSync(e.real),0})),fd_fdstat_get:ge((function(e,t){return e=X(e,c(0)),r.refreshMemory(),r.view.setUint8(t,e.filetype),r.view.setUint16(t+2,0,!0),r.view.setUint16(t+4,0,!0),r.view.setBigUint64(t+8,c(e.rights.base),!0),r.view.setBigUint64(t+8+8,c(e.rights.inheriting),!0),0})),fd_fdstat_set_flags:ge((function(e,t){return X(e,O),52})),fd_fdstat_set_rights:ge((function(e,t,r){return((e=X(e,c(0))).rights.base|t)>e.rights.base||(e.rights.inheriting|r)>e.rights.inheriting?63:(e.rights.base=t,e.rights.inheriting=r,0)})),fd_filestat_get:ge((function(e,t){e=X(e,H);var n=l.fstatSync(e.real);return r.refreshMemory(),r.view.setBigUint64(t,c(n.dev),!0),t+=8,r.view.setBigUint64(t,c(n.ino),!0),t+=8,r.view.setUint8(t,e.filetype),t+=8,r.view.setBigUint64(t,c(n.nlink),!0),t+=8,r.view.setBigUint64(t,c(n.size),!0),t+=8,r.view.setBigUint64(t,pe(n.atimeMs),!0),t+=8,r.view.setBigUint64(t,pe(n.mtimeMs),!0),r.view.setBigUint64(t+8,pe(n.ctimeMs),!0),0})),fd_filestat_set_size:ge((function(e,t){return e=X(e,W),l.ftruncateSync(e.real,Number(t)),0})),fd_filestat_set_times:ge((function(e,t,r,n){e=X(e,z);var i=l.fstatSync(e.real),o=i.atime;i=i.mtime;var s=ye(J(0)),a=3;return(n&a)===a||(n&(a=12))===a?28:(1==(1&n)?o=ye(t):2==(2&n)&&(o=s),4==(4&n)?i=ye(r):8==(8&n)&&(i=s),l.futimesSync(e.real,new Date(o),new Date(i)),0)})),fd_prestat_get:ge((function(e,t){return(e=X(e,c(0))).path?(r.refreshMemory(),r.view.setUint8(t,0),r.view.setUint32(t+4,d.byteLength(e.fakePath),!0),0):28})),fd_prestat_dir_name:ge((function(e,t,n){return(e=X(e,c(0))).path?(r.refreshMemory(),d.from(r.memory.buffer).write(e.fakePath,t,n,"utf8"),0):28})),fd_pwrite:ge((function(e,t,n,i,o){var s=X(e,k|R),a=0;return q(t,n).forEach((function(e){for(var t=0;t<e.byteLength;)t+=l.writeSync(s.real,e,t,e.byteLength-t,Number(i)+a+t);a+=t})),r.view.setUint32(o,a,!0),0})),fd_write:ge((function(e,t,n,i){var o=X(e,k),s=0;return q(t,n).forEach((function(e){for(var t=0;t<e.byteLength;){var r=l.writeSync(o.real,e,t,e.byteLength-t,o.offset?Number(o.offset):null);o.offset&&(o.offset+=c(r)),t+=r}s+=t})),r.view.setUint32(i,s,!0),0})),fd_pread:ge((function(e,t,n,i,s){var a;e=X(e,E|R);var u=0;try{var c=o(q(t,n)),f=c.next();e:for(;!f.done;f=c.next()){var h=f.value;for(t=0;t<h.byteLength;){var d=h.byteLength-t,m=l.readSync(e.real,h,t,h.byteLength-t,Number(i)+u+t);if(t+=m,u+=m,0===m||m<d)break e}u+=t}}catch(e){var p={error:e}}finally{try{f&&!f.done&&(a=c.return)&&a.call(c)}finally{if(p)throw p.error}}return r.view.setUint32(s,u,!0),0})),fd_read:ge((function(e,t,n,i){var s,a=0===(e=X(e,E)).real,u=0;try{var f=o(q(t,n)),h=f.next();e:for(;!h.done;h=f.next()){var d=h.value;for(t=0;t<d.byteLength;){var m=d.byteLength-t,p=l.readSync(e.real,d,t,m,a||void 0===e.offset?null:Number(e.offset));if(a||(e.offset=(e.offset?e.offset:c(0))+c(p)),t+=p,u+=p,0===p||p<m)break e}}}catch(e){var y={error:e}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(y)throw y.error}}return r.view.setUint32(i,u,!0),0})),fd_readdir:ge((function(e,t,n,i,o){e=X(e,C),r.refreshMemory();var s=l.readdirSync(e.path,{withFileTypes:!0}),a=t;for(i=Number(i);i<s.length;i+=1){var u=s[i],f=d.byteLength(u.name);if(t-a>n)break;if(r.view.setBigUint64(t,c(i+1),!0),(t+=8)-a>n)break;var m=l.statSync(h.resolve(e.path,u.name));if(r.view.setBigUint64(t,c(m.ino),!0),(t+=8)-a>n)break;if(r.view.setUint32(t,f,!0),(t+=4)-a>n)break;switch(!0){case m.isBlockDevice():m=1;break;case m.isCharacterDevice():m=2;break;case m.isDirectory():m=3;break;case m.isFIFO():m=6;break;case m.isFile():m=4;break;case m.isSocket():m=6;break;case m.isSymbolicLink():m=7;break;default:m=0}if(r.view.setUint8(t,m),t+=1,(t+=3)+f>=a+n)break;d.from(r.memory.buffer).write(u.name,t),t+=f}return r.view.setUint32(o,Math.min(t-a,n),!0),0})),fd_renumber:ge((function(e,t){return X(e,c(0)),X(t,c(0)),l.closeSync(r.FD_MAP.get(e).real),r.FD_MAP.set(e,r.FD_MAP.get(t)),r.FD_MAP.delete(t),0})),fd_seek:ge((function(e,t,n,i){switch(e=X(e,R),r.refreshMemory(),n){case 1:e.offset=(e.offset?e.offset:c(0))+c(t);break;case 2:n=l.fstatSync(e.real).size,e.offset=c(n)+c(t);break;case 0:e.offset=c(t)}return r.view.setBigUint64(i,e.offset,!0),0})),fd_tell:ge((function(e,t){return e=X(e,U),r.refreshMemory(),e.offset||(e.offset=c(0)),r.view.setBigUint64(t,e.offset,!0),0})),fd_sync:ge((function(e){return e=X(e,M),l.fsyncSync(e.real),0})),path_create_directory:ge((function(e,t,n){return(e=X(e,x)).path?(r.refreshMemory(),t=d.from(r.memory.buffer,t,n).toString(),l.mkdirSync(h.resolve(e.path,t)),0):28})),path_filestat_get:ge((function(e,t,n,i,o){return(e=X(e,j)).path?(r.refreshMemory(),n=d.from(r.memory.buffer,n,i).toString(),n=l.statSync(h.resolve(e.path,n)),r.view.setBigUint64(o,c(n.dev),!0),o+=8,r.view.setBigUint64(o,c(n.ino),!0),o+=8,r.view.setUint8(o,ve(r,void 0,n).filetype),o+=8,r.view.setBigUint64(o,c(n.nlink),!0),o+=8,r.view.setBigUint64(o,c(n.size),!0),o+=8,r.view.setBigUint64(o,pe(n.atimeMs),!0),o+=8,r.view.setBigUint64(o,pe(n.mtimeMs),!0),r.view.setBigUint64(o+8,pe(n.ctimeMs),!0),0):28})),path_filestat_set_times:ge((function(e,t,n,i,o,s,a){if(!(e=X(e,$)).path)return 28;r.refreshMemory();var u=l.fstatSync(e.real);t=u.atime,u=u.mtime;var c=ye(J(0)),f=3;return(a&f)===f||(a&(f=12))===f?28:(1==(1&a)?t=ye(o):2==(2&a)&&(t=c),4==(4&a)?u=ye(s):8==(8&a)&&(u=c),n=d.from(r.memory.buffer,n,i).toString(),l.utimesSync(h.resolve(e.path,n),new Date(t),new Date(u)),0)})),path_link:ge((function(e,t,n,i,o,s,a){return e=X(e,T),o=X(o,L),e.path&&o.path?(r.refreshMemory(),n=d.from(r.memory.buffer,n,i).toString(),s=d.from(r.memory.buffer,s,a).toString(),l.linkSync(h.resolve(e.path,n),h.resolve(o.path,s)),0):28})),path_open:ge((function(e,t,n,i,o,s,u,f,m){t=X(e,B),s=c(s),u=c(u),e=(s&(E|C))!==c(0);var p=(s&(S|k|I|W))!==c(0);if(p&&e)var y=l.constants.O_RDWR;else e?y=l.constants.O_RDONLY:p&&(y=l.constants.O_WRONLY);if(e=s|B,s|=u,0!=(1&o)&&(y|=l.constants.O_CREAT,e|=N),0!=(2&o)&&(y|=l.constants.O_DIRECTORY),0!=(4&o)&&(y|=l.constants.O_EXCL),0!=(8&o)&&(y|=l.constants.O_TRUNC,e|=F),0!=(1&f)&&(y|=l.constants.O_APPEND),0!=(2&f)&&(y=l.constants.O_DSYNC?y|l.constants.O_DSYNC:y|l.constants.O_SYNC,s|=S),0!=(4&f)&&(y|=l.constants.O_NONBLOCK),0!=(8&f)&&(y=l.constants.O_RSYNC?y|l.constants.O_RSYNC:y|l.constants.O_SYNC,s|=M),0!=(16&f)&&(y|=l.constants.O_SYNC,s|=M),p&&0==(y&(l.constants.O_APPEND|l.constants.O_TRUNC))&&(s|=R),r.refreshMemory(),n=d.from(r.memory.buffer,n,i).toString(),n=h.resolve(t.path,n),h.relative(t.path,n).startsWith(".."))return 76;try{var g=l.realpathSync(n);if(h.relative(t.path,g).startsWith(".."))return 76}catch(e){if("ENOENT"!==e.code)throw e;g=n}return y=l.statSync(g).isDirectory()?l.openSync(g,l.constants.O_RDONLY):l.openSync(g,y),n=a(r.FD_MAP.keys()).reverse()[0]+1,r.FD_MAP.set(n,{real:y,filetype:void 0,rights:{base:e,inheriting:s},path:g}),_e(r,n),r.view.setUint32(m,n,!0),0})),path_readlink:ge((function(e,t,n,i,o,s){return(e=X(e,D)).path?(r.refreshMemory(),t=d.from(r.memory.buffer,t,n).toString(),t=h.resolve(e.path,t),t=l.readlinkSync(t),i=d.from(r.memory.buffer).write(t,i,o),r.view.setUint32(s,i,!0),0):28})),path_remove_directory:ge((function(e,t,n){return(e=X(e,Q)).path?(r.refreshMemory(),t=d.from(r.memory.buffer,t,n).toString(),l.rmdirSync(h.resolve(e.path,t)),0):28})),path_rename:ge((function(e,t,n,i,o,s){return e=X(e,P),i=X(i,G),e.path&&i.path?(r.refreshMemory(),t=d.from(r.memory.buffer,t,n).toString(),o=d.from(r.memory.buffer,o,s).toString(),l.renameSync(h.resolve(e.path,t),h.resolve(i.path,o)),0):28})),path_symlink:ge((function(e,t,n,i,o){return(n=X(n,Y)).path?(r.refreshMemory(),e=d.from(r.memory.buffer,e,t).toString(),i=d.from(r.memory.buffer,i,o).toString(),l.symlinkSync(e,h.resolve(n.path,i)),0):28})),path_unlink_file:ge((function(e,t,n){return(e=X(e,K)).path?(r.refreshMemory(),t=d.from(r.memory.buffer,t,n).toString(),l.unlinkSync(h.resolve(e.path,t)),0):28})),poll_oneoff:function(e,t,n,i){var o=0,s=0;r.refreshMemory();for(var a=0;a<n;a+=1){var u=r.view.getBigUint64(e,!0);e+=8;var l=r.view.getUint8(e);switch(e+=1,l){case 0:e+=7,r.view.getBigUint64(e,!0),e+=8;var h=r.view.getUint32(e,!0);e+=4,e+=4,l=r.view.getBigUint64(e,!0),e+=8,r.view.getBigUint64(e,!0),e+=8;var d=r.view.getUint16(e,!0);e+=2,e+=6;var m=1===d;d=0,null===(h=c(J(h)))?d=28:s=(l=m?l:h+l)>s?l:s,r.view.setBigUint64(t,u,!0),t+=8,r.view.setUint16(t,d,!0),t+=2,r.view.setUint8(t,0),t+=1,t+=5,o+=1;break;case 1:case 2:e+=3,r.view.getUint32(e,!0),e+=4,r.view.setBigUint64(t,u,!0),t+=8,r.view.setUint16(t,52,!0),t+=2,r.view.setUint8(t,l),t+=1,t+=5,o+=1;break;default:return 28}}for(r.view.setUint32(i,o,!0);f.hrtime()<s;);return 0},proc_exit:function(e){return f.exit(e),0},proc_raise:function(e){return e in le?(f.kill(le[e]),0):28},random_get:function(e,t){return r.refreshMemory(),f.randomFillSync(new Uint8Array(r.memory.buffer),e,t),0},sched_yield:function(){return 0},sock_recv:function(){return 52},sock_send:function(){return 52},sock_shutdown:function(){return 52}}}return e.prototype.refreshMemory=function(){this.view&&0!==this.view.buffer.byteLength||(this.view=new h(this.memory.buffer))},e.prototype.setMemory=function(e){this.memory=e},e.prototype.start=function(e){if(null===(e=e.exports)||"object"!=typeof e)throw Error("instance.exports must be an Object. Received "+e+".");var t=e.memory;if(!(t instanceof WebAssembly.Memory))throw Error("instance.exports.memory must be a WebAssembly.Memory. Recceived "+t+".");this.setMemory(t),e._start&&e._start()},e.prototype.getImportNamespace=function(e){var t,r=null;try{for(var n=o(WebAssembly.Module.imports(e)),i=n.next();!i.done;i=n.next()){var s=i.value;if("function"===s.kind&&s.module.startsWith("wasi_"))if(r){if(r!==s.module)throw Error("Multiple namespaces detected.")}else r=s.module}}catch(e){var a={error:e}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return r},e.prototype.getImports=function(e){switch(this.getImportNamespace(e)){case"wasi_unstable":return{wasi_unstable:this.wasiImport};case"wasi_snapshot_preview1":return{wasi_snapshot_preview1:this.wasiImport};default:throw Error("Can't detect a WASI namespace for the WebAssembly Module")}},e.defaultBindings=b,e}(),Re=Ee;t.WASI=Re,t.WASIError=be,t.WASIExitError=we,t.WASIKillError=Se,t.default=Ee},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),i=r(0),{isatty:o}=r(3),s=r(4);let a=r(8).default(process.hrtime);process.hrtime&&process.hrtime.bigint&&(a=process.hrtime.bigint);const u={hrtime:a,exit:e=>{process.exit(e)},kill:e=>{process.kill(process.pid,e)},randomFillSync:n.randomFillSync,isTTY:o,fs:i,path:s};t.default=u},function(e,t){!function(e){function t(){}function r(e,t){if(e=void 0===e?"utf-8":e,t=void 0===t?{fatal:!1}:t,-1==n.indexOf(e.toLowerCase()))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+e+"') is invalid.");if(t.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}if(e.TextEncoder&&e.TextDecoder)return!1;var n=["utf-8","utf8","unicode-1-1-utf-8"];Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");t=0;for(var r=e.length,n=0,i=Math.max(32,r+(r>>1)+7),o=new Uint8Array(i>>3<<3);t<r;){var s=e.charCodeAt(t++);if(55296<=s&&56319>=s){if(t<r){var a=e.charCodeAt(t);56320==(64512&a)&&(++t,s=((1023&s)<<10)+(1023&a)+65536)}if(55296<=s&&56319>=s)continue}if(n+4>o.length&&(i+=8,i=(i*=1+t/e.length*2)>>3<<3,(a=new Uint8Array(i)).set(o),o=a),0==(4294967168&s))o[n++]=s;else{if(0==(4294965248&s))o[n++]=s>>6&31|192;else if(0==(4294901760&s))o[n++]=s>>12&15|224,o[n++]=s>>6&63|128;else{if(0!=(4292870144&s))continue;o[n++]=s>>18&7|240,o[n++]=s>>12&63|128,o[n++]=s>>6&63|128}o[n++]=63&s|128}}return o.slice?o.slice(0,n):o.subarray(0,n)},Object.defineProperty(r.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(r.prototype,"fatal",{value:!1}),Object.defineProperty(r.prototype,"ignoreBOM",{value:!1}),r.prototype.decode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");e.buffer instanceof ArrayBuffer&&(e=e.buffer),e=new Uint8Array(e),t=0;for(var r=[],n=[];;){var i=t<e.length;if(!i||65536&t){if(n.push(String.fromCharCode.apply(null,r)),!i)return n.join("");r=[],e=e.subarray(t),t=0}if(0===(i=e[t++]))r.push(0);else if(0==(128&i))r.push(i);else if(192==(224&i)){var o=63&e[t++];r.push((31&i)<<6|o)}else if(224==(240&i)){o=63&e[t++];var s=63&e[t++];r.push((31&i)<<12|o<<6|s)}else if(240==(248&i)){65535<(i=(7&i)<<18|(o=63&e[t++])<<12|(s=63&e[t++])<<6|63&e[t++])&&(i-=65536,r.push(i>>>10&1023|55296),i=56320|1023&i),r.push(i)}}},e.TextEncoder=t,e.TextDecoder=r}("undefined"!=typeof window?window:"undefined"!=typeof global?global:this)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=e=>t=>{const r=e(t);return 1e9*r[0]+r[1]}},function(e,t,r){"use strict";r.r(t),r.d(t,"grainModule",(function(){})),r.d(t,"memory",(function(){return W})),r.d(t,"table",(function(){return z})),r.d(t,"view",(function(){return Y})),r.d(t,"uview",(function(){return Q})),r.d(t,"encoder",(function(){return K})),r.d(t,"decoder",(function(){return V})),r.d(t,"managedMemory",(function(){return q})),r.d(t,"malloc",(function(){return X})),r.d(t,"free",(function(){return Z})),r.d(t,"buildGrainRunner",(function(){return te})),r.d(t,"dumpMemoryStats",(function(){return re})),r.d(t,"GrainNodeRunner",(function(){return ie})),r.d(t,"defaultFileLocator",(function(){return $})),r.d(t,"grainToString",(function(){return g}));var n={};r.r(n),r.d(n,"grainDOMRefs",(function(){return l})),r.d(n,"DOMQuery",(function(){return h})),r.d(n,"DOMSetText",(function(){return d})),r.d(n,"DOMDangerouslySetInnerHTML",(function(){return m})),r.d(n,"DOMAddEventListener",(function(){return p}));r(7);const i={heapAdjust(e){throw new S(-1,"Grain runtime is not yet instantiated.")}};function o(e){return t=>function(e,t){if(0===t)return;let r=i.heapAdjust(0);(e.opts&&e.opts.limitMemory)>0&&W.buffer.byteLength>=e.opts.limitMemory||W.buffer.byteLength-r<t&&W.grow(1)}(e,t)}function s(e,t){return-1===e||2147483647===e||1879048191===e?15:1&e?1==(7&e)?1:5==(7&e)?5:3==(7&e)?3:void(t||console.warn("<getTagType: Unknown value: 0x"+new Number(e).toString(16))):0}function a(e,t,r){(t&function(e){switch(e){case 0:return 1;default:return 7}}(e))!==e&&E(r,t,0)}function u(e,t,r){a(3,t,r),Y[(3^t)/4]!=e&&E(r,t,0)}const c=(e,t)=>u(1,e,t||93),f=(e,t)=>u(2,e,t||92),l=[];function h(e){c(e);let t=b(null,e),r=document.querySelector(t);if(r){l.push(r);let e=X(4*2)/4;return Y[e]=2,Y[e+1]=l.length-1,4*e^3}return 2147483647}function d(e,t){return f(e),c(t),b(null,e).innerText=b(null,t),e}function m(e,t){return f(e),c(t),b(null,e).innerHTML=b(null,t),e}function p(e,t,r){var n;f(e),c(t),a(5,r,n||96);let i=b(null,e),o=b(null,t),s=b(null,r);return i.addEventListener(o,()=>s.call()),e}function y(e,t){switch(Y[t/4]){case 1:{let e=new Uint8Array(W.buffer),r=Y[t/4+1],n=e.slice(t+8,t+8+r);return`"${V.decode(n)}"`}case 2:return l[Y[(t+4)/4]].toString();case 3:{let r=t/4;if(e){let n=Y[r+1]>>1,i=Y[r+2]>>1,o=Y[r+3]>>1,s=e.idMap[n],a=e.modules[s].types[i];if(0===Object.keys(a).length)return"<adt value>";let u=a[o],[c,f]=u;if("[...]"===c)return function(e,t){let r=t,n=[];for(;;){let t=r/4;if(0===Y[t+3]>>1)break;n.push(g(e,Y[t+5])),r=3^Y[t+6]}return`[${n.join(", ")}]`}(e,t);let l=[];for(let t=0;t<f;++t)l.push(g(e,Y[r+5+t]));return 0===f?c:`${c}(${l.join(", ")})`}return"<adt value>"}case 4:{let r=t/4;if(e){let t=Y[r+1]>>1,n=Y[r+2]>>1,i=e.idMap[t],o=e.modules[i].types[n];if(0===Object.keys(o).length)return"<record value>";let s=[];for(let[t,n]of Object.entries(o))s.push(`${t}: ${g(e,Y[r+4+n]).replace(/\n/g,"\n  ")}`);return`{\n  ${s.join(",\n  ")}\n}`}return"<record value>"}case 5:{let r=t/4,n=Y[r+1],i=[];for(let t=0;t<n;t++)i.push(g(e,Y[r+2+t]));return`[> ${i.join(", ")}]`}case 6:return Y[t/4+1].toString(10);case 7:{let e=t/4,r=Q[e+1],n=Y[e+2],i=n<0,o=[];i&&(n=~n,r=1+~r);let s=(n%10*2**32+r)%10;for(o.unshift(s);r>=10||n>0;)r=Math.floor((n%10*2**32+r)/10),n=Math.floor(n/10),s=(n%10*2**32+r)%10,o.unshift(s);return i&&o.unshift("-"),o.join("")}default:return`<unknown heap type: ${Y[t/4]}>`}}function g(e,t){if(1&t){if(1==(7&t)){let r=(1^t)/4,n=Y[r];if(2147483648&n)return`<cyclic tuple ${2147483647&t}>`;{Y[r]|=2147483648;let t=[];for(let i=0;i<n;++i)t.push(g(e,Y[r+i+1]));return 1==t.length&&t.push("\b"),Y[r]=n,`(${t.join(", ")})`}}return 5==(7&t)?"<lambda>":3==(7&t)?y(e,3^t):-1===t?"true":2147483647===t?"false":1879048191===t?"void":`<Unknown value: 0x${t}>`}return(t>>1).toString()}class _{constructor(e){this._elts=e}get elts(){return this._elts}}function v(e,t){switch(Y[t/4]){case 1:let r=new Uint8Array(W.buffer),n=Y[t/4+1],i=r.slice(t+8,t+8+n);return V.decode(i);case 2:return l[Y[t/4+1]];case 3:let o=t/4;if(e){let r=function(e,t){let r=t/4;if(e){let t=Y[r+1]>>1,n=Y[r+2]>>1,i=Y[r+3]>>1,o=e.idMap[t];return e.modules[o].types[n][i]}return null}(e,t),[n,i]=r,s=[n];for(let t=0;t<i;++t)s.push(b(e,Y[o+5+t]));return new _(s)}default:return void console.warn(`Unknown heap tag at ${t/4}: ${Y[t/4]}`)}}function b(e,t){return 1&t?5==(7&t)?()=>{throw new S("Computed Grain functions are not callable from JavaScript.")}:3==(7&t)?v(e,3^t):1==(7&t)?function(e,t){let r=t/4,n=Y[r];if(2147483648&n)return Symbol.for("cyclic");{Y[r]|=2147483648;let t=[];for(let i=0;i<n;++i){let n=b(e,Y[r+i+1]);n===Symbol.for("cyclic")?t.push(t):t.push(n)}return Y[r]=n,t}}(e,1^t):-1===t||2147483647!==t&&(1879048191===t?null:void console.warn(`Unknown Grain value: ${t} (0x${t.toString(16)})`)):t>>1}function w(e){if("number"==typeof e)return e>=1<<30&&throwGrainError(GRAIN_ERR_OVERFLOW,-1,-1),e<<1;if("boolean"==typeof e)return e?-1:2147483647;if("string"==typeof e){let t=q.malloc((e.length-1)/4+1+8),r=t/4;Y[r]=1,Y[r+1]=e.length;let n=new Uint8Array(W.buffer),i=K.encode(e);for(let e=0;e<i.length;++e)n[e+4*r+8]=i[e];return 3|t}throw new S(-1,"JSToGrainVal not implemented for value with type "+typeof e)}_.prototype.toString=function(){return 1===this._elts.length?this._elts[0]:`${this._elts[0]}(${this._elts.slice(1).join(", ")})`};class S extends Error{constructor(e,t){super(t),this.name="GrainError",this.code=e}}function E(e,t,r){let n,i=g(null,t);switch(e){case 10:n=`arity mismatch (expected ${t} arguments, but got ${r})`;break;case 1:n="arithmetic expected a number, got value: "+i;break;case 0:n="comparison expected a number, got value: "+i;break;case 17:n="division by zero";break;case 18:n="modulo by zero";break;case 99:n="expected a number, got value: "+i;break;case 94:n="expected a boolean, got value: "+i;break;case 95:n="expected a tuple, got value: "+i;break;case 96:n="expected a lambda, got value: "+i;break;case 4:n="number overflow with value: "+i;break;case 3:n="if expected a boolean, got value: "+i;break;case 2:n="logic expected a boolean, got value: "+i;break;case 93:n="expected a string, got value: "+i;break;case 91:n="expected an ADT value, got value: "+i;break;case 92:n="expected a DOM element, got value: "+i;break;case 5:n="tuple access expected tuple, got value: "+i;break;case 12:n="tuple assignment expected tuple, got value: "+i;break;case 6:n="tuple access expected number for index, got value: "+i;break;case 13:n="tuple assignment expected number for index, got value: "+i;break;case 7:case 14:n=`tuple index too small: ${i} (tuple arity: ${r})`;break;case 8:case 15:n=`tuple index too large: ${i} (tuple arity: ${r})`;break;case 19:n="array index out of bounds";break;case 16:n="value has no switch case: "+i;break;case 9:n="called non-function: "+i;break;case 98:n="expected a nonnegative number, got value: "+i;break;case 11:n="Out of memory";break;case 20:n="Invalid argument: "+i;break;case 21:n="Assertion error";break;case 22:n="Failure: "+i;break;case 23:n="System error: "+i;break;default:n="Unknown error code: "+e}throw new S(e,n)}function R(e){return console.log(g(null,e)),1879048191}function O(e){return t=>(console.log(e(t)),1879048191)}function M(e,t,r){"use asm";var n=8192;var i=1;var o=8;var s=3;var a=new e.Uint32Array(r);var u=t.growHeap;var c=t.initialHeapSize|0;var f=0;function l(e){e=e|0;var t=0;var r=0;var n=0;n=f|0;if((f|0)==0){f=c|0;if((e|0)>(f|0)){t=e-f|0;r=u(t|0)|0;if((r|0)==(-1|0)){return-1|0}f=(f|0)+(r|0)|0}return n|0}else{r=u(e|0)|0;if((r|0)==(-1|0)){return-1|0}f=(f|0)+(r|0)|0}return n|0}function h(e){e=e|0;var t=0;var r=0;var n=0;var u=0;var c=0;var l=0;n=e+o-1|0;n=(n|0)/(o|0)|0;n=n+1|0;e=(n|0)<<(s|0);l=l|0;t=t|0;r=i|0;if((f|0)==0){a[0]=0;i=0;r=0;a[1]=0}for(t=a[r>>2]|0;;r=t|0,t=a[t>>2]|0){l=a[t+4>>2]|0;if((l|0)>=(e|0)){if((l|0)==(e|0)){a[r>>2]=a[t>>2]|0}else{c=l-e|0;a[t+4>>2]=c|0;t=t+c|0;a[t+4>>2]=e|0}i=r|0;return t+8|0}if((t|0)==(i|0)){t=d(e|0)|0;if((t|0)==(-1|0)){return-1|0}}}return-1|0}function d(e){e=e|0;var t=0;var r=0;var o=0;var s=0;o=f|0;if((e|0)<(n|0)){e=n|0}t=l(e)|0;if((t|0)==(-1|0)){return-1|0}s=(f|0)-(o|0)|0;r=t;a[r+4>>2]=s|0;m((r|0)+8|0);return i|0}function m(e){e=e|0;var t=0;var r=0;var n=0;t=e-8|0;if((t|0)==(i|0)){return}for(r=i|0;!((t|0)>(r|0)&(t|0)<(a[r>>2]|0));r=a[r>>2]|0){if((r|0)>=(a[r>>2]|0)&((t|0)>(r|0)|(t|0)<(a[r>>2]|0))){break}}if((t+(a[t+4>>2]|0)|0)==(a[r>>2]|0)){n=a[r>>2]|0;a[t+4>>2]=(a[t+4>>2]|0)+(a[n+4>>2]|0);a[t>>2]=a[n>>2]|0}else{a[t>>2]=a[r>>2]|0}if((r+(a[r+4>>2]|0)|0)==(t|0)){a[r+4>>2]=(a[r+4>>2]|0)+(a[t+4>>2]|0)|0;a[r>>2]=a[t>>2]|0}else{a[r>>2]=t|0}i=r}function p(){return i|0}return{malloc:h,free:m,getFreePtr:p}}r(1);const U=Symbol("GREEN"),k=Symbol("RED"),A=(Symbol("BLUE"),Symbol("BLACK"));function I(e){0}var x=r(5),N=r(6),T=r.n(N),L=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};const B=new x.WASI({args:process.argv,env:process.env,bindings:L({},T.a),preopens:{"/sandbox":process.cwd()}});class C{constructor(e,t){this.wasmModule=e,this.name=t,this.runner=null,this._cmi=null,this._instantiated=null}get isInstantiated(){return null!==this._instantiated}get instantiated(){if(!this.isInstantiated)throw new S(-1,`Module${this.name?" "+this.name:""} must be instantiated before use`);return this._instantiated}get cmi(){if(!this._cmi){let e=WebAssembly.Module.customSections(this.wasmModule,"cmi");if(0===e.length)return console.warn(`Grain Module${this.name?" "+this.name:""} missing CMI information`),null;let t=e[0],r=20+new Uint32Array(t.slice(0,20))[4],n=t.slice(r,t.byteLength),i=new TextDecoder("utf-8").decode(n);this._cmi=JSON.parse(i)}return this._cmi}get importSpecs(){return WebAssembly.Module.imports(this.wasmModule)}get exportSpecs(){return WebAssembly.Module.exports(this.wasmModule)}get customSections(){return WebAssembly.Module.customSections(this.wasmModule)}get exports(){return this.instantiated.exports}get isGrainModule(){return!!this.exports._start}requiredExport(e){let t=this.exports;if(!(e in t))throw new Error(`Module ${this.name} missing required export: ${e}`);return t[e]}start(){B.start(this.instantiated)}get tableSize(){return this.requiredExport("GRAIN$TABLE_SIZE")}get cleanupGlobals(){return this.requiredExport("GRAIN$CLEANUP_GLOBALS")}get types(){if(!this._types){let e=this.cmi;if(!e)return null;this._types={},e.cmi_sign.forEach(e=>{if("TSigType"!==e[0])return;let t=e[2].type_path[1].stamp,r={};this._types[t]=r;let n=e[2].type_kind;if(n)switch(n[0]){case"TDataVariant":n[1].forEach((e,t)=>{let n,i=e.cd_id.name;n="TConstrSingleton"===e.cd_args[0]?0:e.cd_args[1].length,r[t]=[i,n]});break;case"TDataRecord":n[1].forEach((e,t)=>{let n=e.rf_name.name;r[n]=t});break;default:return}})}return this._types}async instantiate(e,t){this.runner=t;try{this._instantiated=await WebAssembly.instantiate(this.wasmModule,e)}catch(e){throw console.error("Exception while instantiating "+this.name),e}}async runUnboxed(){return B.setMemory(this.requiredExport("memory")),await this.requiredExport("_start")()}}async function D(e){const t=r(0);let n=e.replace(/\.gr\(lib\)?$/,"").replace(/.*\/([^/]+)/,"$1"),i=await WebAssembly.compile(t.readFileSync(e));return new C(i,n)}async function P(e){let t=e;console.log("Reading module at URL: "+e);let r=await fetch(e);if(!r.ok)throw new Error(`[Grain] Could not load ${e} due to a network error.`);let n=await WebAssembly.compileStreaming(r);return new C(n,t)}function G(e){return t=>w(e(t))}class j{constructor(e,t,r){this.modules={},this.imports={},this.idMap={},this.locator=e,t=t||{},this.opts=t,this.ptr=0,this.ptrZero=0,this._checkMemory=o(this),this.limitMemory=t.limitMemory||-1,this.postImports=()=>{},this.imports.grainRuntime={checkMemory:this._checkMemory,relocBase:0,moduleRuntimeId:0};let n=e=>g(this,e);this.imports.grainBuiltins={toString:G(n),print:O(n)}}checkMemory(){return this._checkMemory()}addImport(e,t){this.imports[e]=t}addImports(e){Object.keys(e).forEach(t=>{t in this.imports?this.imports[t]=Object.assign(this.imports[t],e[t]):this.imports[t]=e[t]})}async load(e,t){let r=t.importSpecs;for(let e of r)if(!(e.module in this.imports)){if(e.module in this.modules){console.warn("Ignoring possible cyclic dependency: "+e.module);continue}if(e.module.startsWith("wasi_")){Object.assign(this.imports,B.getImports(t.wasmModule));continue}let r=await this.locator(e.module);if(!r)throw new S(-1,"Failed to locate required module: "+e.module);this.modules[e.module]=r,await this.load(e.module,r),r.isGrainModule&&(await r.start(),this.imports.grainRuntime.relocBase+=r.tableSize,++this.imports.grainRuntime.moduleRuntimeId),this.ptrZero=this.ptr,this.imports[e.module]=r.exports}return this.postImports(),await t.instantiate(this.imports,this),this.idMap[this.imports.grainRuntime.moduleRuntimeId]=e,e in this.modules||(this.modules[e]=t),t}async loadFile(e){let t=await D(e);return this.load(t.name,t)}async runFileUnboxed(e,t){let r=await this.loadFile(e),n=r.runUnboxed();return t&&r.cleanupGlobals(),n}async runFile(e){return(await this.loadFile(e)).start()}async loadURL(e){let t=await P(e);return this.load(t.name,t)}async runURL(e){return(await this.loadURL(e)).start()}async runURLUnboxed(e){return(await this.loadURL(e)).runUnboxed()}}function F(e){if(e)return e.replace(/\/$/,"")}function $(e=[]){const t=r(0);return e=e.map(F),async r=>{let n=r.replace(/^GRAIN\$MODULE\$/,"");for(const r of e){let e=r+"/"+n+".wasm";if(t.existsSync(e))return D(e)}return null}}var H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};const W=new WebAssembly.Memory({initial:16}),z=new WebAssembly.Table({element:"anyfunc",initial:1024}),Y=new Int32Array(W.buffer),Q=new Uint32Array(W.buffer),K=new TextEncoder("utf-8"),V=new TextDecoder("utf-8"),q=new class{constructor(e){this._memory=e,this._headerSize=8,this._runtime=null,"undefined"==typeof window?this._globNS=global:this._globNS=window,this._mallocModule=M(this._globNS,{initialHeapSize:e.buffer.byteLength,growHeap:()=>this._growHeap()},this._memory.buffer),this._grown=0,this._colors={},this._markQueue=[],this._jumpStack=[]}_growHeap(){return this._runtime&&this._runtime.limitMemory>=0&&this._grown>=this._runtime.limitMemory?-1:(this._grown+=1024,0)}setRuntime(e){this._runtime=e,e.limitMemory>=0&&(this._mallocModule=M(this._globNS,{initialHeapSize:e.limitMemory,growHeap:()=>this._growHeap()},this._memory.buffer),this._grown=0)}malloc(e){this._scanQueue(),I(this._toHex(e));let t=this._mallocModule.malloc(e+this._headerSize);if(-1===t||this._runtime&&this._runtime.limitMemory>=0&&this._runtime.limitMemory<=t)throw I((this._runtime&&this._runtime.limitMemory,this._runtime&&this._runtime.limitMemory>=0&&this._runtime.limitMemory)),"Out of memory";I(),this.populateHeader(t),I();let r=t+this._headerSize;return I(this._memdump(r)),this._markIncRefSource(r,"MALLOC"),this._colors[r]=U,r}populateHeader(e){I();var t=new Uint8Array(this._memory.buffer);for(let r=0;r<this._headerSize;++r)t[e+r]=0;this._setRefCount(e,1),t[e+3]=0}_getRefCount(e){I();let t=(-8&e)-this._headerSize,r=new Uint8Array(this._memory.buffer);I((this._toBinary(r[t],8,8),this._toBinary(r[t+1],8,8),this._toBinary(r[t+2],8,8)));let n=7&r[t];return n<<=8,n|=r[t+1],n<<=8,n|=r[t+2],I(),n}_getValueTag(e){I();let t=e-this._headerSize;return new Uint8Array(this._memory.buffer)[t+3]}_toHex(e,t){}_toBinary(e,t,r){}_memdump(e){}decRef64(e){return I(),this.decRef(e)}incRef64(e){return I(),this.incRef(e,"64")}incRefADT(e){return I(),this.incRef(e,"ADT")}incRefArray(e){return I(),this.incRef(e,"ARRAY")}decRefArray(e){return I(),this.decRef(e,"ARRAY")}incRefTuple(e){return I(),this.incRef(e,"TUPLE")}decRefTuple(e){return I(),this.decRef(e,"TUPLE")}incRefBox(e){return I(),this.incRef(e,"BOX")}decRefBox(e){return I(),this.decRef(e,"BOX")}incRefBackpatch(e){return I(),this.incRef(e,"BACKPATCH")}incRefSwapBind(e){return I(),this.incRef(e,"SWAP")}decRefSwapBind(e){return I(),this.decRef(e,"SWAP")}incRefArgBind(e){return I(),this.incRef(e,"ARG")}decRefArgBind(e){return I(),this.decRef(e,"ARG")}incRefLocalBind(e){return I(),this.incRef(e,"LOCAL")}decRefLocalBind(e){return I(),this.decRef(e,"LOCAL")}incRefGlobalBind(e){return I(),this.incRef(e,"GLOBAL")}decRefGlobalBind(e){return I(),this.decRef(e,"GLOBAL")}incRefClosureBind(e){return I(),this.incRef(e,"CLOSURE")}decRefClosureBind(e){return I(),this.decRef(e,"CLOSURE")}incRefCleanupLocals(e){return I(),this.incRef(e,"CLEANUP_LOCALS")}decRefIgnoreZeros(e){return I(),this.decRef(e,void 0,!0)}decRefCleanupLocals(e,t){return I(),this.decRef(e,"CLEANUP_LOCALS",!0)}decRefCleanupGlobals(e){return I(),this.decRef(e,"CLEANUP_GLOBALS",!0)}decRefDrop(e){return I(),this.decRef(e,"DROP",!0)}_markIncRefSource(e,t){0}_markDecRefSource(e,t){0}_setRefCount(e,t){const r=new Uint8Array(this._memory.buffer);I(),I((this._toBinary(r[e],8,8),this._toBinary(r[e+1],8,8),this._toBinary(r[e+2],8,8))),r[e]=(8323072&t)>>16,r[e+1]=(65280&t)>>8,r[e+2]=255&t,I((this._toBinary(r[e],8,8),this._toBinary(r[e+1],8,8),this._toBinary(r[e+2],8,8)))}incRef(e,t){let r=e;I(this._toHex(e));let n=s(e,!0);if(0===e||0===n||15===n)return I(),r;e&=-8,this._colors[e]=U,this._markIncRefSource(e,t||"UNK"),I();let i=e-this._headerSize,o=this._getRefCount(e);return++o,I(),this._setRefCount(i,o),I(this._memdump(e)),r}*references(e){const t=new Int32Array(this._memory.buffer),r=s(e,!0);switch(e&=-8,r){case 1:let n=e/4,i=t[n];if(2147483648&i)return;t[n]|=2147483648,I(this._toHex(e));for(let e=0;e<i;++e)yield t[n+e+1];t[n]=i;break;case 5:let o=e/4,s=t[o+2];I(this._toHex(e));for(let e=0;e<s;++e)yield t[o+3+e];break;case 3:let a=e;switch(t[a/4]){case 3:if(this._runtime){let r=a/4,n=t[r+4];I(this._toHex(e));for(let e=0;e<n;++e)yield t[r+5+e]}}break;default:console.warn(`<decRef: Unexpected value tag: 0x${this._toHex(r)}> [userPtr=0x${this._toHex(e)}]`)}}_isReference(e){let t=s(e,!0);return!(0===e||0===t||15===t)}_getColor(e){return this._colors[-8&e]||U}_recolor(e,t,r){this._getColor(e)!==t&&(this._colors[-8&e]=t)}_markRed(e,t){if(this._isReference(e)&&(I(this._toHex(e)),this._getColor(e)!==k)){this._recolor(e,k,t);for(let r of this.references(e))this._decrementRefCount(r,t);for(let r of this.references(e))this._getColor(r)!==k&&this._markRed(r,t),this._getRefCount(r)>0&&!this._jumpStack.includes(r)&&this._jumpStack.push(r)}}_scan(e,t){let r=e;s(e,!0);if(!this._isReference(e))return I(),r;if(I(this._toHex(e)),this._getRefCount(e)>0)this._scanGreen(e,t),this._jumpStack=[];else{for(;this._jumpStack.length>0;){let e=this._jumpStack.pop();I((this._toHex(e),this._getColor(e).toString())),this._getColor(e)===k&&this._getRefCount(e)>0&&this._scanGreen(e,t)}this._collect(e,t)}}_scanGreen(e,t){if(this._isReference(e)){I(this._toHex(e)),this._recolor(e,U,t);for(let r of this.references(e))this._incrementRefCount(r),this._getColor(r)!==U&&this._scanGreen(r,t)}}_collect(e,t){if(this._isReference(e)&&(I(this._toHex(e)),this._getColor(e)===k)){this._recolor(e,U,t);for(let r of this.references(e))this._getColor(r)===k&&this._collect(r,t);this.free(-8&e),this._markQueue.includes(e)&&(this._markQueue=this._markQueue.filter(t=>t!=e)),this._markQueue.includes(-8&e)&&(this._markQueue=this._markQueue.filter(t=>t!=(-8&e)))}}_scanQueue(){for(this._markQueue.reverse();this._markQueue.length>0;){let e=this._markQueue.pop();I(this._toHex(e)),this._getColor(e)===A&&(this._markRed(e),this._scan(e))}}_incrementRefCount(e){if(!this._isReference(e)){s(e,!0);return void I()}let t=(e&=-8)-this._headerSize,r=this._getRefCount(e);this._setRefCount(t,r+1)}_decrementRefCount(e,t){if(!this._isReference(e)){s(e,!0);return void I()}e&=-8;let r=this._getRefCount(e);if(0===r){if(t)return I(),e;throw I(JSON.stringify(this._colors)),new Error("decRef called when reference count was zero. "+this._memdump(e))}let n=e-this._headerSize;this._setRefCount(n,r-1)}decRef(e,t,r){I(this._toHex(e)),t&&"COLLECT"!==t&&(this._jumpStack=[]);let n=e,i=s(e,!0);if(0===e||0===i||15===i)return I(),n;e&=-8,this._markDecRefSource(e,t||"UNK");new Uint8Array(this._memory.buffer);let o=e-this._headerSize,a=this._getRefCount(e);if(0===a){if(r)return I(),e;throw I(JSON.stringify(this._colors)),new Error("decRef called when reference count was zero. "+this._memdump(e))}if(--a,I(),I(),0===a){I();for(let e of this.references(n))this.decRef(e,"FREE");this._recolor(e,U,r),this._setRefCount(o,a),this.free(e)}else this._setRefCount(o,a),this._recolor(n,A),this._markQueue.push(n);return n}free(e){I(new Number(e).toString(16)),I(this._memdump(e)),I(this._toHex(e-this._headerSize)),this._mallocModule.free(e-this._headerSize),I(),I()}_numAllocations(){let e=0;for(let t of Object.values(this._timesAllocated))e+=t;return e}_numFrees(){let e=0;for(let t of Object.values(this._timesFreed))e+=t;return e}_dumpRefTree(){}prepareExit(){}}(W),X=q.malloc.bind(q),Z=q.free.bind(q),J={decRefIgnoreZeros:q.decRefIgnoreZeros.bind(q)},ee={env:{memory:W},console:{log:R,debug:function(e){return console.log(`0x${e.toString(16)} (0b${e.toString(2)})`),e},printClosure:function(e){let t=Y[e/=4],r=Y[e+1],n=Y[e+2],i=[];for(var o=0;o<n;++o)i.push(R(Y[e+o+3]));return console.log(`<closure@${e}: idx=${r}, arity=${t}, size=${n}: ${i}>`),console.log(Y.slice(0,32)),e},tracepoint:e=>console.log(`tracepoint ${e} reached`)},grainRuntime:H({mem:W,tbl:z,throwError:E,malloc:q.malloc.bind(q),free:q.free.bind(q),incRef:q.incRef.bind(q),incRef64:q.incRef64.bind(q),decRef:q.decRef.bind(q),decRef64:q.decRef64.bind(q)},J),grainBuiltins:H({},n)};function te(e,t){let r=new j(e||(e=>null),t);return r.addImports(ee),q.setRuntime(r),r}function re(){q.prepareExit()}let ne=te();async function ie(e){return(await ne.loadFile(e)).run()}t.default=async function(e){return(await ne.loadURL(e)).run()}}]);